<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>VietEasy Pro</title>
    <!-- 核心套件 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --sat: env(safe-area-inset-top); --sab: env(safe-area-inset-bottom); }
        body { 
            -webkit-tap-highlight-color: transparent; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overscroll-behavior-y: contain;
            background-color: #f8fafc;
            margin: 0;
            padding: 0;
        }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-pb { padding-bottom: calc(1.5rem + var(--sab)); }
        .safe-pt { padding-top: calc(1.25rem + var(--sat)); }
        
        /* 初始載入動畫 */
        #loader {
            position: fixed; inset: 0; background: white; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>
    <div id="loader">
        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #dc2626; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <p style="margin-top: 10px; font-weight: bold; color: #64748b;">正在載入 30,000 字庫...</p>
    </div>
    <div id="root"></div>

    <script>
        // 大數據生成邏輯
        if (!window.VIET_DATABASE) {
            const levels = ['simple', 'beginner', 'intermediate', 'upper', 'hard'];
            const mockData = [];
            for (let i = 1; i <= 30000; i++) {
                mockData.push({
                    id: i,
                    level: levels[i % 5],
                    vn: i === 1 ? "Xin chào" : `Từ vựng ${i}`,
                    phonetic: i === 1 ? "seen chow" : `phát âm ${i}`,
                    cn: i === 1 ? "你好" : `單字 ${i}`,
                    en: i === 1 ? "Hello" : `Word ${i}`,
                    example: `Ví dụ cho từ vựng số ${i}.`
                });
            }
            window.VIET_DATABASE = mockData;
        }

        const GRAMMAR_DATA = [
            { id: 1, title: "主語 + 動詞 + 賓語", content: "越南文的基本語序與中文完全一致。", example: "Tôi ăn cơm (我吃飯)" },
            { id: 2, title: "形容詞後置", content: "在越南文中，形容詞要放在名詞後面。", example: "Người đẹp (人 + 美 = 美女)" },
            { id: 3, title: "否定詞 'Không'", content: "在動詞前面加上 Không 即可否定。", example: "Tôi không biết (我不知道)" }
        ];

        window.onload = () => {
            const loader = document.getElementById('loader');
            if (loader) loader.style.display = 'none';
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        const Icon = ({ name, className }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('study');
            const [selectedLevel, setSelectedLevel] = useState('all');
            const [cardIdx, setCardIdx] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [masteredIds, setMasteredIds] = useState(() => {
                try {
                    const saved = localStorage.getItem('viet_mastered_ids');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) { return []; }
            });
            const [voices, setVoices] = useState([]);

            useEffect(() => {
                localStorage.setItem('viet_mastered_ids', JSON.stringify(masteredIds));
            }, [masteredIds]);

            useEffect(() => {
                const loadVoices = () => setVoices(window.speechSynthesis.getVoices());
                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;
            }, []);

            const speak = useCallback((text) => {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                const vnVoice = voices.find(v => v.lang.includes('vi') || v.name.includes('Vietnamese'));
                if (vnVoice) utterance.voice = vnVoice;
                utterance.lang = 'vi-VN';
                utterance.rate = 0.85;
                window.speechSynthesis.speak(utterance);
            }, [voices]);

            const filteredVocab = useMemo(() => {
                const db = window.VIET_DATABASE || [];
                return selectedLevel === 'all' ? db : db.filter(w => w.level === selectedLevel);
            }, [selectedLevel]);

            const currentCard = filteredVocab[cardIdx];

            return (
                <div className="flex flex-col h-screen max-w-md mx-auto bg-slate-50 relative overflow-hidden shadow-2xl">
                    <header className="bg-red-600 text-white safe-pt px-6 pb-6 shadow-xl z-20">
                        <div className="flex justify-between items-end">
                            <div>
                                <h1 className="text-2xl font-black tracking-tighter">VIETEASY PRO</h1>
                                <p className="text-[10px] opacity-70 font-bold uppercase tracking-widest">離線學習字卡</p>
                            </div>
                            <div className="text-right">
                                <span className="text-[10px] font-bold bg-white/20 px-2 py-1 rounded">V1.0 OFFLINE</span>
                            </div>
                        </div>
                    </header>

                    <div className="bg-white border-b border-slate-200 p-3 flex gap-2 overflow-x-auto no-scrollbar z-10">
                        {['all', 'simple', 'beginner', 'intermediate', 'upper', 'hard'].map(l => (
                            <button key={l} onClick={() => {setSelectedLevel(l); setCardIdx(0); setIsFlipped(false);}}
                                className={`px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap transition-all ${selectedLevel === l ? 'bg-red-600 text-white shadow-lg scale-105' : 'bg-slate-100 text-slate-500'}`}>
                                {l.toUpperCase()}
                            </button>
                        ))}
                    </div>

                    <main className="flex-1 overflow-y-auto p-4 relative">
                        {activeTab === 'study' && currentCard && (
                            <div className="space-y-6">
                                <div className="flex justify-between items-center px-2">
                                    <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{currentCard.level}</span>
                                    <span className="text-[10px] font-mono text-slate-400">{cardIdx + 1} / {filteredVocab.length}</span>
                                </div>

                                <div className="relative h-96 w-full perspective-1000" onClick={() => setIsFlipped(!isFlipped)}>
                                    <div className={`relative w-full h-full transition-all duration-700 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                                        <div className="absolute inset-0 bg-white rounded-[2.5rem] shadow-xl border border-slate-100 flex flex-col items-center justify-center p-8 backface-hidden">
                                            <h2 className="text-5xl font-black text-slate-800 mb-2">{currentCard.vn}</h2>
                                            <p className="text-xl text-blue-500 font-mono mb-12">/{currentCard.phonetic}/</p>
                                            <button onClick={(e) => {e.stopPropagation(); speak(currentCard.vn);}} className="w-20 h-20 bg-red-50 text-red-600 rounded-full flex items-center justify-center shadow-inner active:scale-90 transition-transform">
                                                <Icon name="volume-2" className="w-10 h-10" />
                                            </button>
                                        </div>
                                        <div className="absolute inset-0 bg-slate-900 text-white rounded-[2.5rem] shadow-2xl flex flex-col p-8 rotate-y-180 backface-hidden">
                                            <div className="flex-1 flex flex-col justify-center items-center gap-6">
                                                <div className="text-center">
                                                    <p className="text-[10px] text-slate-500 font-bold mb-1 uppercase tracking-widest">中文</p>
                                                    <p className="text-3xl font-bold">{currentCard.cn}</p>
                                                </div>
                                                <div className="text-center">
                                                    <p className="text-[10px] text-slate-500 font-bold mb-1 uppercase tracking-widest">English</p>
                                                    <p className="text-2xl font-bold text-red-400 italic">{currentCard.en}</p>
                                                </div>
                                            </div>
                                            <div className="bg-white/5 p-4 rounded-2xl mb-6 text-sm text-slate-300 border border-white/5 italic">
                                                {currentCard.example}
                                            </div>
                                            <button onClick={(e) => {
                                                    e.stopPropagation();
                                                    setMasteredIds(prev => prev.includes(currentCard.id) ? prev.filter(id => id !== currentCard.id) : [...prev, currentCard.id]);
                                                }}
                                                className={`w-full py-4 rounded-2xl font-black transition-all ${masteredIds.includes(currentCard.id) ? 'bg-green-600' : 'bg-red-600'}`}>
                                                {masteredIds.includes(currentCard.id) ? '已學會 ✓' : '標記掌握'}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-4">
                                    <button onClick={() => {setIsFlipped(false); setCardIdx(p => (p - 1 + filteredVocab.length) % filteredVocab.length)}} className="flex-1 py-5 bg-white rounded-3xl border border-slate-200 shadow-sm active:bg-slate-100 flex justify-center"><Icon name="arrow-left" /></button>
                                    <button onClick={() => {setIsFlipped(false); setCardIdx(p => (p + 1) % filteredVocab.length)}} className="flex-[2] py-5 bg-slate-900 text-white rounded-3xl shadow-xl font-black active:scale-95 transition-transform">下一張卡片</button>
                                </div>
                            </div>
                        )}

                        {activeTab === 'grammar' && (
                            <div className="space-y-4">
                                <h2 className="text-xl font-black text-slate-800 px-2">文法解析</h2>
                                {GRAMMAR_DATA.map(g => (
                                    <div key={g.id} className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm">
                                        <h3 className="font-bold text-lg text-red-600 mb-1">{g.title}</h3>
                                        <p className="text-slate-600 text-sm mb-4">{g.content}</p>
                                        <div className="bg-slate-50 p-4 rounded-2xl font-mono text-sm border-l-4 border-red-500">{g.example}</div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'progress' && (
                            <div className="space-y-6">
                                <div className="bg-white p-8 rounded-[2.5rem] shadow-sm text-center">
                                    <div className="relative w-32 h-32 mx-auto mb-4">
                                        <svg className="w-full h-full" viewBox="0 0 36 36">
                                            <path className="stroke-slate-100" fill="none" strokeWidth="3" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                            <path className="stroke-red-600" fill="none" strokeWidth="3" strokeDasharray={`${(masteredIds.length / window.VIET_DATABASE.length) * 100}, 100`} d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                        </svg>
                                        <div className="absolute inset-0 flex items-center justify-center flex-col">
                                            <span className="text-2xl font-black">{masteredIds.length}</span>
                                            <span className="text-[8px] text-slate-400 font-bold uppercase">Mastered</span>
                                        </div>
                                    </div>
                                    <h3 className="text-xl font-black">當前進度圖表</h3>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="bg-blue-600 p-6 rounded-3xl text-white shadow-lg">
                                        <p className="text-[10px] font-bold opacity-70">掌握率</p>
                                        <p className="text-2xl font-black">{((masteredIds.length / window.VIET_DATABASE.length) * 100).toFixed(2)}%</p>
                                    </div>
                                    <div className="bg-slate-900 p-6 rounded-3xl text-white shadow-lg">
                                        <p className="text-[10px] font-bold opacity-70">數據庫總量</p>
                                        <p className="text-2xl font-black">30,000</p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-xl border-t border-slate-100 safe-pb px-6 pt-4 flex justify-around max-w-md mx-auto z-30">
                        {[{id:'study',icon:'layers',label:'學習'}, {id:'grammar',icon:'book-open',label:'文法'}, {id:'progress',icon:'activity',label:'進度'}].map(t => (
                            <button key={t.id} onClick={() => setActiveTab(t.id)} className={`flex flex-col items-center gap-1 transition-all ${activeTab === t.id ? 'text-red-600 scale-110 font-bold' : 'text-slate-400'}`}>
                                <Icon name={t.icon} className="w-6 h-6" />
                                <span className="text-[10px] uppercase tracking-tighter">{t.label}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <style>
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</body>
</html>
