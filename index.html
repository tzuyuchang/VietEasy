<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>VietEasy Pro</title>
    <!-- æ ¸å¿ƒå¥—ä»¶ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- åŒ¯å…¥å¤–éƒ¨å–®å­—åº« -->
    <script src="database.js"></script>

    <style>
        :root { --sat: env(safe-area-inset-top); --sab: env(safe-area-inset-bottom); }
        body { 
            -webkit-tap-highlight-color: transparent; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overscroll-behavior-y: contain;
            background-color: #f8fafc;
            margin: 0; padding: 0;
        }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-pb { padding-bottom: calc(1.5rem + var(--sab)); }
        .safe-pt { padding-top: calc(1.25rem + var(--sat)); }
        
        #loader {
            position: fixed; inset: 0; background: white; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loader">
        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #dc2626; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <p style="margin-top: 15px; font-weight: bold; color: #64748b;">æ­£åœ¨è¼‰å…¥å­¸ç¿’è³‡æº...</p>
    </div>
    <div id="root"></div>

    <script>
        // --- å®Œæ•´æ–‡æ³•è³‡æ–™åº« ---
        const GRAMMAR_DATA = [
            { id: 1, category: "åŸºç¤å¥å‹", title: "åŸºæœ¬èªåº (SVO)", content: "è¶Šå—æ–‡èªåºè·Ÿä¸­æ–‡å¹¾ä¹ä¸€æ¨£ï¼šä¸»è© + å‹•è© + å—è©ã€‚", example: "TÃ´i (æˆ‘) yÃªu (æ„›) Viá»‡t Nam (è¶Šå—)." },
            { id: 2, category: "åŸºç¤å¥å‹", title: "å®šç¾©å¥ (LÃ )", content: "ã€ŒLÃ ã€ç­‰æ–¼ä¸­æ–‡çš„ã€Œæ˜¯ã€ã€‚å¦å®šç”¨ã€ŒkhÃ´ng pháº£i lÃ ã€ã€‚", example: "Anh áº¥y lÃ  bÃ¡c sÄ©. (ä»–æ˜¯é†«ç”Ÿ) / TÃ´i khÃ´ng pháº£i lÃ  giÃ¡o viÃªn. (æˆ‘ä¸æ˜¯è€å¸«)" },
            { id: 3, category: "åŸºç¤å¥å‹", title: "å½¢å®¹è©å¾Œç½®", content: "âš ï¸ é‡é»ï¼šå½¢å®¹è©æ”¾åœ¨åè©ã€Œå¾Œé¢ã€ã€‚é€™é»è·Ÿä¸­æ–‡ç›¸åï¼", example: "CÃ´ gÃ¡i Ä‘áº¹p (å¥³å­© + ç¾ = ç¾å¥³) / CÃ  phÃª sá»¯a (å’–å•¡ + å¥¶ = ç…‰ä¹³å’–å•¡)" },
            { id: 4, category: "æ™‚æ…‹", title: "æ­£åœ¨ (Äang)", content: "åœ¨å‹•è©å‰åŠ ã€ŒÄ‘angã€è¡¨ç¤ºå‹•ä½œæ­£åœ¨é€²è¡Œã€‚", example: "Anh Ä‘ang lÃ m gÃ¬? (ä½ æ­£åœ¨åšä»€éº¼ï¼Ÿ)" },
            { id: 5, category: "æ™‚æ…‹", title: "å·²ç¶“ (ÄÃ£ ... rá»“i)", content: "å‹•è©å‰åŠ ã€ŒÄ‘Ã£ã€æˆ–å¥å°¾åŠ ã€Œrá»“iã€è¡¨ç¤ºå®Œæˆã€‚", example: "Em Äƒn cÆ¡m chÆ°a? (å¦³åƒé£¯äº†å—ï¼Ÿ) - Em Äƒn rá»“i. (æˆ‘åƒé£½äº†)" },
            { id: 6, category: "æ™‚æ…‹", title: "å°‡è¦ (Sáº½)", content: "åœ¨å‹•è©å‰åŠ ã€Œsáº½ã€è¡¨ç¤ºæœªä¾†è¨ˆç•«ã€‚", example: "NgÃ y mai anh sáº½ Ä‘i HÃ  Ná»™i. (æ˜å¤©æˆ‘å°‡å»æ²³å…§)" },
            { id: 7, category: "ç–‘å•/å¦å®š", title: "æ˜¯éå•å¥ (CÃ³...khÃ´ng)", content: "å¥å‹ï¼šS + cÃ³ + V/Adj + khÃ´ng? (æœ‰...å—ï¼Ÿ/æ˜¯...å—ï¼Ÿ)", example: "Em cÃ³ má»‡t khÃ´ng? (å¦³ç´¯å—ï¼Ÿ) - CÃ³, em má»‡t. (æ˜¯ï¼Œæˆ‘ç´¯)" },
            { id: 8, category: "ç–‘å•/å¦å®š", title: "å¦å®šå¥ (KhÃ´ng)", content: "ç›´æ¥åœ¨å‹•è©æˆ–å½¢å®¹è©å‰åŠ ã€ŒkhÃ´ngã€ã€‚", example: "Anh khÃ´ng thÃ­ch. (æˆ‘ä¸å–œæ­¡)" },
            { id: 9, category: "â¤ï¸ æˆ€æ„›å¿…ä¿®", title: "ç”œèœœç¨±å‘¼ (Anh & Em)", content: "æˆ€æ„›ä¸­ï¼Œç”·ç”Ÿè‡ªç¨± Anh (å“¥å“¥)ï¼Œç¨±å¥³ç”Ÿ Em (å¦¹å¦¹)ã€‚ä¸è«–å¯¦éš›å¹´é½¡å¤§å°ï¼Œé€™æ˜¯æœ€è¦ªå¯†ã€ç”œèœœçš„å«æ³•ã€‚", example: "Anh nhá»› em. (æˆ‘æƒ³å¦³ - ç”·å°å¥³èªª) / Em yÃªu anh. (æˆ‘æ„›ä½  - å¥³å°ç”·èªª)" },
            { id: 10, category: "â¤ï¸ æˆ€æ„›å¿…ä¿®", title: "æƒ³å¿µ (Nhá»›)", content: "Nhá»› æ—¢æ˜¯ã€Œè¨˜å¾—ã€ä¹Ÿæ˜¯ã€Œæƒ³å¿µã€ã€‚", example: "Anh cÃ³ nhá»› em khÃ´ng? (ä½ æœ‰æƒ³æˆ‘ä¸ï¼Ÿ) - Anh ráº¥t nhá»› em. (æˆ‘å¾ˆæƒ³å¦³)" },
            { id: 11, category: "â¤ï¸ æˆ€æ„›å¿…ä¿®", title: "é‚€ç´„èªæ°£ (NhÃ©)", content: "å¥å°¾åŠ ã€ŒnhÃ©ã€è¡¨ç¤ºæè­°ã€é‚€ç´„ï¼Œç›¸ç•¶æ–¼ã€Œå§ã€ã€ã€Œå–”ã€ã€‚è½èµ·ä¾†å¾ˆæº«æŸ”ã€‚", example: "Tá»‘i nay Ä‘i xem phim nhÃ©? (ä»Šæ™šå»çœ‹é›»å½±å¥½å—ï¼Ÿ)" },
            { id: 12, category: "å£èªè¡¨é”", title: "ç¨‹åº¦å‰¯è© (Ráº¥t / QuÃ¡)", content: "Ráº¥t (å¾ˆ) æ”¾å½¢å®¹è©å‰ã€‚QuÃ¡ (å¤ª...) æ”¾å½¢å®¹è©å¾Œï¼ŒQuÃ¡ å¸¸ç”¨æ–¼æ„Ÿå˜†ã€‚", example: "Ráº¥t vui (å¾ˆé«˜èˆˆ) / Äáº¹p quÃ¡! (å¤ªç¾äº†ï¼)" },
            { id: 13, category: "å£èªè¡¨é”", title: "æ•¬èª (áº )", content: "å°é•·è¼©æˆ–åˆæ¬¡è¦‹é¢ï¼Œå¥å°¾åŠ ã€Œáº¡ã€è¡¨ç¤ºç¦®è²Œã€‚å¥³ç”Ÿç”¨çš„è©±æœƒé¡¯å¾—å¾ˆä¹–å·§ã€‚", example: "ChÃ o anh áº¡! (å“¥å“¥å¥½ï¼)" }
        ];

        // --- ç™¼éŸ³è¦å‰‡è³‡æ–™åº« ---
        const PRONUNCIATION_DATA = {
            vowels: [
                { char: 'a', desc: 'å˜´å·´å¼µå¤§ï¼Œåƒä¸­æ–‡ã€Œé˜¿ã€', ex: 'ca (æ¯å­)' },
                { char: 'Äƒ', desc: 'çŸ­éŸ³ aï¼Œç™¼éŸ³æ€¥ä¿ƒï¼Œå˜´è§’ä¸Šæš', ex: 'Äƒn (åƒ)' },
                { char: 'Ã¢', desc: 'çŸ­éŸ³ï¼Œåƒã€Œå„ã€ï¼Œå˜´å·´æ”¾é¬†å¾®é–‹', ex: 'cÃ¢n (æ–¤)' },
                { char: 'e', desc: 'å˜´å·´æ‰å¹³ï¼Œåƒè‹±æ–‡ bed çš„ e', ex: 'me (é…¸è§’)' },
                { char: 'Ãª', desc: 'åƒè‹±æ–‡ hey çš„ eyï¼Œå˜´å·´æ‰ä½†ç·Šä¸€é»', ex: 'bÃª (å°ç‰›)' },
                { char: 'i', desc: 'å˜´è§’å‘å…©é‚Šæ‹‰é–‹ï¼Œåƒã€Œä¸€ã€', ex: 'Ä‘i (èµ°)' },
                { char: 'o', desc: 'å˜´å·´åœ“ï¼Œåƒæ³¨éŸ³ã€Œã„›ã€', ex: 'to (å¤§)' },
                { char: 'Ã´', desc: 'å˜´å·´å˜Ÿåœ“ï¼Œåƒè‹±æ–‡ go', ex: 'cÃ´ (å§‘å§‘)' },
                { char: 'Æ¡', desc: 'å˜´å·´è‡ªç„¶å¼µé–‹ï¼Œåƒã€Œå„ã€é•·éŸ³', ex: 'phá»Ÿ (æ²³ç²‰)' },
                { char: 'u', desc: 'å˜´å·´å˜Ÿèµ·ï¼Œåƒã€Œçƒã€', ex: 'thu (ç§‹å¤©)' },
                { char: 'Æ°', desc: 'åƒ u ä½†å˜´è§’å‘å…©é‚Šæ‹‰ï¼Œåƒå’¬ç‰™åˆ‡é½’', ex: 'tÆ° (ç§)' },
                { char: 'y', desc: 'é•·éŸ³çš„ iï¼Œç™¼éŸ³èˆ‡ i ç›¸åŒ', ex: 'y tÃ¡ (è­·å£«)' }
            ],
            complex_vowels: [
                { char: 'ai', desc: 'åƒä¸­æ–‡ã€Œæ„›ã€', ex: 'cÃ¡i (å€‹)' },
                { char: 'ao', desc: 'åƒä¸­æ–‡ã€Œå¥§ã€', ex: 'cao (é«˜)' },
                { char: 'au', desc: 'åƒè‹±æ–‡ cow çš„ owï¼Œå˜´å·´æœ€å¾Œä¸åœ“', ex: 'sau (å¾Œ)' },
                { char: 'Ã¢u', desc: 'åƒè‹±æ–‡ ohï¼Œä½†æ›´çŸ­', ex: 'cÃ¢u (å¥)' },
                { char: 'eo', desc: 'åƒè²“å«è²ã€Œå–µã€çš„å¾Œæ®µ', ex: 'kÃ©o (å‰ªåˆ€)' },
                { char: 'ia / iÃª', desc: 'i æ»‘å‘ aï¼Œåƒã€Œä¼Šäºã€', ex: 'kia (é‚£è£¡)' },
                { char: 'ua / uÃ´', desc: 'u æ»‘å‘ aï¼Œåƒã€Œçƒé˜¿ã€', ex: 'mua (è²·)' },
                { char: 'Æ°a / Æ°Æ¡', desc: 'Æ° æ»‘å‘ aï¼Œåƒã€Œå„é˜¿ã€', ex: 'mÆ°a (é›¨)' },
                { char: 'yÃªu', desc: 'ä¸‰æ¯éŸ³ï¼Œåƒã€Œä¼Š~è€¶~çƒã€', ex: 'yÃªu (æ„›)' },
                { char: 'oai', desc: 'ä¸‰æ¯éŸ³ï¼Œåƒã€Œæ­ªã€', ex: 'xoÃ i (èŠ’æœ)' }
            ],
            consonants_start: [
                { char: 'b', desc: 'åƒã„…ï¼Œä¸é€æ°£', ex: 'ba (ä¸‰)' },
                { char: 'c/k/q', desc: 'åƒã„ï¼Œä¸é€æ°£', ex: 'cÃ¡ (é­š)' },
                { char: 'ch', desc: 'åƒã„“ï¼ŒèˆŒé¢éŸ³', ex: 'chá»‹ (å§Šå§Š)' },
                { char: 'd/gi', desc: 'åŒ—éƒ¨éŸ³åƒ z (za)ï¼Œå—éƒ¨éŸ³åƒ y (ya)', ex: 'da (çš®è†š)' },
                { char: 'Ä‘', desc: 'åƒã„‰ï¼ŒèˆŒå°–é ‚ä¸Šé½’é½¦', ex: 'Ä‘i (èµ°)' },
                { char: 'g/gh', desc: 'å–‰éŸ³æ¿è¼”éŸ³ï¼Œåƒã„ä½†æ›´æ·±', ex: 'gÃ  (é›)' },
                { char: 'h', desc: 'åƒã„', ex: 'hoa (èŠ±)' },
                { char: 'kh', desc: 'åƒã„ï¼Œä½†æœ‰æ‘©æ“¦è²', ex: 'khÃ´ng (ä¸)' },
                { char: 'l', desc: 'åƒã„Œ', ex: 'lÃ  (æ˜¯)' },
                { char: 'm', desc: 'åƒã„‡', ex: 'máº¹ (åª½åª½)' },
                { char: 'n', desc: 'åƒã„‹', ex: 'no (é£½)' },
                { char: 'ng/ngh', desc: 'é¼»éŸ³ï¼Œåƒ sing çš„ ng', ex: 'ngá»§ (ç¡)' },
                { char: 'nh', desc: 'åƒå¦³å¥½ Nya çš„éŸ³', ex: 'nhÃ  (å®¶)' },
                { char: 'p', desc: 'å­—é¦–æ¥µå°‘è¦‹ï¼Œåƒã„…', ex: 'pin (é›»æ± )' },
                { char: 'ph', desc: 'åƒã„ˆ', ex: 'phá»Ÿ (æ²³ç²‰)' },
                { char: 'r', desc: 'åŒ—éƒ¨åƒ zï¼Œå—éƒ¨åƒæ²èˆŒ r', ex: 'ra (å‡º)' },
                { char: 's', desc: 'åŒ—éƒ¨åƒ sï¼Œå—éƒ¨æ²èˆŒ sh', ex: 'sá»¯a (å¥¶)' },
                { char: 't', desc: 'åƒã„‰', ex: 'tÃ´i (æˆ‘)' },
                { char: 'th', desc: 'åƒã„Š', ex: 'thÃ­ch (å–œæ­¡)' },
                { char: 'tr', desc: 'åŒ—éƒ¨åƒ chï¼Œå—éƒ¨æ²èˆŒ tr', ex: 'trÃ  (èŒ¶)' },
                { char: 'v', desc: 'åƒ vï¼Œä¸Šé½’å’¬ä¸‹å”‡', ex: 'vá» (å›)' },
                { char: 'x', desc: 'åƒ s (çµ²)', ex: 'xe (è»Š)' }
            ],
            consonants_end: [
                { char: '-c / -ch', desc: 'æ€¥ä¿ƒæ”¶å°¾ï¼Œå˜´å·´ä¸é–‹', ex: 'há»c (å­¸)' },
                { char: '-n', desc: 'èˆŒå°–é ‚ä¸Šé¡ï¼Œåƒæ©', ex: 'báº¡n (æœ‹å‹)' },
                { char: '-ng', desc: 'å˜´å¼µé–‹ï¼Œå–‰åš¨é¼»éŸ³', ex: 'vÃ¢ng (æ˜¯)' },
                { char: '-nh', desc: 'é–‰æ°£éŸ³ï¼ŒèˆŒé¢è²¼ä¸Šé¡', ex: 'xinh (æ¼‚äº®)' },
                { char: '-t', desc: 'èˆŒå°–é ‚ä¸Šé½’é½¦æ”¶å°¾', ex: 'tá»‘t (å¥½)' },
                { char: '-p', desc: 'é›™å”‡é–‰åˆæ”¶å°¾', ex: 'Ä‘áº¹p (ç¾)' },
                { char: '-m', desc: 'é›™å”‡é–‰åˆï¼Œåƒåºµ', ex: 'cÆ¡m (é£¯)' }
            ]
        };

        window.onload = () => {
            if (!window.VIET_DATABASE) {
                 window.VIET_DATABASE = [{ id: 1, level: 'simple', vn: 'Lá»—i', phonetic: 'loi', cn: 'éŒ¯èª¤', en: 'Error', example: 'è«‹ç¢ºèª database.js æ˜¯å¦å­˜åœ¨' }];
                 alert("æé†’ï¼šæ‰¾ä¸åˆ° database.jsï¼Œè«‹ç¢ºèªæª”æ¡ˆæ˜¯å¦å·²ä¸Šå‚³è‡³ GitHubã€‚");
            }
            const loader = document.getElementById('loader');
            if (loader) loader.style.display = 'none';
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        const Icon = ({ name, className }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('study');
            const [selectedLevel, setSelectedLevel] = useState('all');
            const [pronunciationTab, setPronunciationTab] = useState('vowels');
            const [cardIdx, setCardIdx] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [masteredIds, setMasteredIds] = useState(() => {
                try {
                    const saved = localStorage.getItem('viet_mastered_ids');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) { return []; }
            });
            const [voices, setVoices] = useState([]);

            useEffect(() => {
                localStorage.setItem('viet_mastered_ids', JSON.stringify(masteredIds));
            }, [masteredIds]);

            useEffect(() => {
                const loadVoices = () => setVoices(window.speechSynthesis.getVoices());
                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;
            }, []);

            const speak = useCallback((text) => {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                const vnVoice = voices.find(v => v.lang.includes('vi') || v.name.includes('Vietnamese'));
                if (vnVoice) utterance.voice = vnVoice;
                utterance.lang = 'vi-VN';
                utterance.rate = 0.85;
                window.speechSynthesis.speak(utterance);
            }, [voices]);

            const filteredVocab = useMemo(() => {
                const db = window.VIET_DATABASE || [];
                return selectedLevel === 'all' ? db : db.filter(w => w.level === selectedLevel);
            }, [selectedLevel]);

            const currentCard = filteredVocab[cardIdx];

            return (
                <div className="flex flex-col h-screen max-w-md mx-auto bg-slate-50 relative overflow-hidden">
                    <header className="bg-red-600 text-white safe-pt px-6 pb-6 shadow-xl z-20">
                        <div className="flex justify-between items-end">
                            <div>
                                <h1 className="text-2xl font-black tracking-tighter">VIETEASY PRO</h1>
                                <p className="text-[10px] opacity-70 font-bold uppercase tracking-widest text-white/80">ç™¼éŸ³ã€å–®å­—ã€æ–‡æ³•å…¨åˆ¶éœ¸</p>
                            </div>
                            <div className="text-right">
                                <span className="text-[10px] font-bold bg-white/20 px-2 py-1 rounded">V2.1</span>
                            </div>
                        </div>
                    </header>

                    {/* Level Bar (Only for Study Tab) */}
                    {activeTab === 'study' && (
                        <div className="bg-white border-b border-slate-200 p-3 flex gap-2 overflow-x-auto no-scrollbar z-10">
                            {['all', 'simple', 'beginner', 'intermediate', 'upper', 'hard'].map(l => (
                                <button key={l} onClick={() => {setSelectedLevel(l); setCardIdx(0); setIsFlipped(false);}}
                                    className={`px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap transition-all ${selectedLevel === l ? 'bg-red-600 text-white shadow-lg' : 'bg-slate-100 text-slate-500'}`}>
                                    {l.toUpperCase()}
                                </button>
                            ))}
                        </div>
                    )}

                    <main className="flex-1 overflow-y-auto p-4 relative pb-24">
                        {/* 1. ç™¼éŸ³å€å¡Š (Pronunciation) */}
                        {activeTab === 'pronunciation' && (
                            <div className="space-y-4 animate-in fade-in">
                                <h2 className="text-xl font-black text-slate-800 px-2 flex items-center gap-2">
                                    <Icon name="mic" className="w-5 h-5 text-red-500" />
                                    ç™¼éŸ³ç¸½å‰‡
                                </h2>
                                
                                {/* Pronunciation Sub-tabs */}
                                <div className="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                                    {[
                                        {id: 'vowels', label: 'å–®æ¯éŸ³'},
                                        {id: 'complex_vowels', label: 'é›™/ä¸‰æ¯éŸ³'},
                                        {id: 'consonants_start', label: 'å­—é¦–å­éŸ³'},
                                        {id: 'consonants_end', label: 'å­—å°¾å­éŸ³'}
                                    ].map(sub => (
                                        <button 
                                            key={sub.id} 
                                            onClick={() => setPronunciationTab(sub.id)}
                                            className={`px-3 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-colors ${pronunciationTab === sub.id ? 'bg-slate-800 text-white' : 'bg-white border border-slate-200 text-slate-600'}`}
                                        >
                                            {sub.label}
                                        </button>
                                    ))}
                                </div>

                                <div className="grid grid-cols-2 gap-3">
                                    {PRONUNCIATION_DATA[pronunciationTab].map((item, idx) => (
                                        <div key={idx} className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow flex flex-col items-center text-center relative"
                                            onClick={() => speak(item.ex)}>
                                            <div className="absolute top-2 right-2 text-slate-300">
                                                <Icon name="volume-2" className="w-4 h-4" />
                                            </div>
                                            <div className="text-3xl font-black text-red-600 mb-1">{item.char}</div>
                                            <p className="text-[10px] text-slate-400 mb-2 font-mono">{item.ex}</p>
                                            <div className="bg-slate-50 p-2 rounded-lg w-full">
                                                <p className="text-xs text-slate-600 leading-tight">{item.desc}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <p className="text-center text-xs text-slate-400 mt-4 italic">ğŸ’¡ é»æ“Šå¡ç‰‡å³å¯è†è½ã€Œç¯„ä¾‹å–®å­—ã€ç™¼éŸ³</p>
                            </div>
                        )}

                        {/* 2. å­¸ç¿’å­—å¡å€å¡Š (Study) */}
                        {activeTab === 'study' && currentCard ? (
                            <div className="space-y-6">
                                <div className="flex justify-between items-center px-2">
                                    <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{currentCard.level}</span>
                                    <span className="text-[10px] font-mono text-slate-400">{cardIdx + 1} / {filteredVocab.length}</span>
                                </div>

                                <div className="relative h-96 w-full perspective-1000" onClick={() => setIsFlipped(!isFlipped)}>
                                    <div className={`relative w-full h-full transition-all duration-700 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                                        <div className="absolute inset-0 bg-white rounded-[2.5rem] shadow-xl border border-slate-100 flex flex-col items-center justify-center p-8 backface-hidden">
                                            <h2 className="text-5xl font-black text-slate-800 mb-2 text-center leading-tight">{currentCard.vn}</h2>
                                            <p className="text-xl text-blue-500 font-mono mb-12">/{currentCard.phonetic}/</p>
                                            <button onClick={(e) => {e.stopPropagation(); speak(currentCard.vn);}} className="w-20 h-20 bg-red-50 text-red-600 rounded-full flex items-center justify-center shadow-inner active:scale-90 transition-transform">
                                                <Icon name="volume-2" className="w-10 h-10" />
                                            </button>
                                        </div>
                                        <div className="absolute inset-0 bg-slate-900 text-white rounded-[2.5rem] shadow-2xl flex flex-col p-8 rotate-y-180 backface-hidden">
                                            <div className="flex-1 flex flex-col justify-center items-center gap-6">
                                                <div className="text-center">
                                                    <p className="text-[10px] text-slate-500 font-bold mb-1 uppercase tracking-widest">ä¸­æ–‡</p>
                                                    <p className="text-3xl font-bold">{currentCard.cn}</p>
                                                </div>
                                                <div className="text-center">
                                                    <p className="text-[10px] text-slate-500 font-bold mb-1 uppercase tracking-widest">English</p>
                                                    <p className="text-2xl font-bold text-red-400 italic">{currentCard.en}</p>
                                                </div>
                                            </div>
                                            <div className="bg-white/5 p-4 rounded-2xl mb-6 text-sm text-slate-300 border border-white/5 italic text-center">
                                                "{currentCard.example}"
                                            </div>
                                            <button onClick={(e) => {
                                                    e.stopPropagation();
                                                    setMasteredIds(prev => prev.includes(currentCard.id) ? prev.filter(id => id !== currentCard.id) : [...prev, currentCard.id]);
                                                }}
                                                className={`w-full py-4 rounded-2xl font-black transition-all ${masteredIds.includes(currentCard.id) ? 'bg-green-600' : 'bg-red-600'}`}>
                                                {masteredIds.includes(currentCard.id) ? 'å·²å­¸æœƒ âœ“' : 'æ¨™è¨˜æŒæ¡'}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-4">
                                    <button onClick={() => {setIsFlipped(false); setCardIdx(p => (p - 1 + filteredVocab.length) % filteredVocab.length)}} className="flex-1 py-5 bg-white rounded-3xl border border-slate-200 shadow-sm active:bg-slate-100 flex justify-center"><Icon name="arrow-left" /></button>
                                    <button onClick={() => {setIsFlipped(false); setCardIdx(p => (p + 1) % filteredVocab.length)}} className="flex-[2] py-5 bg-slate-900 text-white rounded-3xl shadow-xl font-black active:scale-95 transition-transform">ä¸‹ä¸€å¼µå¡ç‰‡</button>
                                </div>
                            </div>
                        ) : activeTab === 'study' ? (
                            <div className="flex flex-col items-center justify-center py-20 text-slate-400">
                                <Icon name="search-x" className="w-16 h-16 mb-4 opacity-20" />
                                <p className="font-bold">è¼‰å…¥ä¸­æˆ–ç„¡è³‡æ–™...</p>
                            </div>
                        ) : null}

                        {/* 3. æ–‡æ³•å€å¡Š (Grammar) */}
                        {activeTab === 'grammar' && (
                            <div className="space-y-4 animate-in slide-in-from-bottom-4">
                                <h2 className="text-xl font-black text-slate-800 px-2 flex items-center gap-2">
                                    <Icon name="book-open" className="w-5 h-5 text-red-500" />
                                    æ–‡æ³•å¯¶å…¸
                                </h2>
                                {GRAMMAR_DATA.map((g, idx) => (
                                    <div key={idx} className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm relative overflow-hidden">
                                        <div className="absolute top-0 right-0 bg-slate-100 px-3 py-1 rounded-bl-xl text-[10px] font-bold text-slate-500 uppercase">
                                            {g.category}
                                        </div>
                                        <h3 className="font-bold text-lg text-red-600 mb-2 mt-2">{g.title}</h3>
                                        <p className="text-slate-600 text-sm mb-4 leading-relaxed">{g.content}</p>
                                        <div className="bg-red-50 p-4 rounded-2xl text-sm border-l-4 border-red-500 text-slate-700">
                                            <span className="font-bold text-red-800 text-xs block mb-1">ä¾‹å¥ï¼š</span>
                                            {g.example}
                                        </div>
                                    </div>
                                ))}
                                <div className="text-center text-xs text-slate-400 py-4 italic">
                                    ç†Ÿè®€ä»¥ä¸Šæ–‡æ³•ï¼Œæˆ€æ„›æºé€šæ²’å•é¡Œï¼
                                </div>
                            </div>
                        )}

                        {/* 4. é€²åº¦å€å¡Š (Progress) */}
                        {activeTab === 'progress' && (
                            <div className="space-y-6 animate-in zoom-in-95">
                                <div className="bg-white p-8 rounded-[2.5rem] shadow-sm text-center border border-slate-100">
                                    <div className="relative w-32 h-32 mx-auto mb-4">
                                        <svg className="w-full h-full" viewBox="0 0 36 36">
                                            <path className="stroke-slate-100" fill="none" strokeWidth="3" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                            <path className="stroke-red-600" fill="none" strokeWidth="3" strokeDasharray={`${(masteredIds.length / (window.VIET_DATABASE?.length || 1)) * 100}, 100`} d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                        </svg>
                                        <div className="absolute inset-0 flex items-center justify-center flex-col">
                                            <span className="text-2xl font-black text-slate-800">{masteredIds.length}</span>
                                            <span className="text-[8px] text-slate-400 font-bold uppercase">å·²æŒæ¡</span>
                                        </div>
                                    </div>
                                    <h3 className="text-xl font-black text-slate-800">å­¸ç¿’é€²åº¦æ¦‚è¦½</h3>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="bg-blue-600 p-6 rounded-3xl text-white shadow-lg">
                                        <p className="text-[10px] font-bold opacity-70 uppercase tracking-widest">æŒæ¡ç‡</p>
                                        <p className="text-2xl font-black">{((masteredIds.length / (window.VIET_DATABASE?.length || 1)) * 100).toFixed(1)}%</p>
                                    </div>
                                    <div className="bg-slate-900 p-6 rounded-3xl text-white shadow-lg">
                                        <p className="text-[10px] font-bold opacity-70 uppercase tracking-widest">å–®å­—ç¸½é‡</p>
                                        <p className="text-2xl font-black">{(window.VIET_DATABASE?.length || 0).toLocaleString()}</p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Bottom Navigation */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-xl border-t border-slate-100 safe-pb px-6 pt-4 flex justify-around max-w-md mx-auto z-30">
                        {[
                            {id: 'pronunciation', icon: 'mic', label: 'ç™¼éŸ³'},
                            {id: 'study', icon: 'layers', label: 'å­—å¡'},
                            {id: 'grammar', icon: 'book-open', label: 'æ–‡æ³•'},
                            {id: 'progress', icon: 'activity', label: 'é€²åº¦'}
                        ].map(t => (
                            <button key={t.id} onClick={() => setActiveTab(t.id)} className={`flex flex-col items-center gap-1 transition-all ${activeTab === t.id ? 'text-red-600 scale-110 font-bold' : 'text-slate-400'}`}>
                                <Icon name={t.icon} className="w-6 h-6" />
                                <span className="text-[10px] uppercase tracking-tighter">{t.label}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
